# Web Helper Chrome Extension

## 概要
Webページでの作業を効率化するChrome拡張機能です。拡張のアイコンをクリックすると、フローティングメニューが表示され、便利な機能にアクセスできます。

## 主な機能

### 1. フルページスクリーンショット
- 開いているページ全体（スクロール範囲を含む）のスクリーンショットを取得
- スクロールが必要な長いページでも完全にキャプチャ
- 取得した画像は自動的にダウンロード

### 2. 一括チェックボックス操作
- ページ内のすべてのチェックボックスを一括でチェック/アンチェック
- フォーム入力時の作業効率を大幅に改善

## 技術仕様

### ファイル構成
```
utilityChromeExtension/
├── manifest.json          # 拡張の設定ファイル
├── popup.html             # フローティングメニューのHTML
├── popup.css              # メニューのスタイル
├── popup.js               # メニューの動作制御
├── content.js             # Webページに注入されるスクリプト
├── background.js          # バックグラウンドスクリプト
├── lib/                   # 外部ライブラリ
│   └── html2canvas.min.js # HTMLをCanvasに変換するライブラリ
└── icons/                 # 拡張のアイコン
    ├── icon16.png
    ├── icon48.png
    └── icon128.png
```

### 必要な権限
- `activeTab`: 現在のタブでのスクリプト実行
- `scripting`: コンテンツスクリプトの注入
- `downloads`: スクリーンショットファイルのダウンロード
- `debugger`: Chrome DevTools Protocol へのアクセス

### 主要な実装ポイント

#### フルページスクリーンショット
Chrome DevTools Protocol を使用した高品質なフルページキャプチャ：

**技術仕様:**
- **Chrome DevTools Protocol**: `Page.captureScreenshot` API を直接使用
- **条件分岐による最適化**: ページサイズに応じて自動的に最適な手法を選択
- **サイズ制限対応**: Chrome の 16384px 制限を考慮した実装

**キャプチャ方式:**
1. **小さなページ (≤16384px)**: 
   - `Emulation.setDeviceMetricsOverride` でページ全体サイズに画面を拡大
   - 一発でフルページスクリーンショットを取得（高速・高品質）

2. **大きなページ (>16384px)**:
   - タイル分割による `clip` パラメータでの精密キャプチャ（8000px単位）
   - `OffscreenCanvas` で効率的な画像結合
   - メモリ使用量を最適化

**主な特徴:**
- **固定ヘッダー自動対応**: DevTools Protocol が自動で適切に処理
- **高解像度対応**: `devicePixelRatio` を考慮した精密な描画
- **メモリ管理**: `createImageBitmap()` でリーク防止
- **Service Worker対応**: FileReader API を使用したデータURL変換

#### チェックボックス操作
- `document.querySelectorAll('input[type="checkbox"]')`でチェックボックスを取得
- 各要素の`checked`プロパティを一括操作
- 無効化されたチェックボックスは除外

#### フローティングメニュー
- 拡張アイコンクリック時に`popup.html`を表示
- シンプルで直感的なUI設計
- 各機能ボタンからコンテンツスクリプトへのメッセージ送信

## 使用方法

1. Chrome拡張をインストール
2. 対象Webページを開く
3. 拡張アイコンをクリック
4. フローティングメニューから機能を選択

## 開発・実装時の注意点

### セキュリティ
- Content Security Policy (CSP) に準拠
- 外部ライブラリの使用時は適切な権限設定

### 互換性
- Chrome Manifest V3 対応
- 最新のChrome APIを使用

### エラーハンドリング
- スクリーンショット取得失敗時の適切なメッセージ表示
- チェックボックスが存在しない場合の処理

### パフォーマンス
- **条件分岐による最適化**: ページサイズに応じて最適な手法を自動選択
- **タイル処理**: 大きなページでも確実にキャプチャ（8000px単位の分割）
- **メモリ効率**: OffscreenCanvas と ImageBitmap による最適化
- **レイアウト調整**: キャプチャ前の500ms待機で安定したレンダリング

## 実装済み機能

### ✅ 完了済み
1. **基本構造**: Manifest V3 対応の拡張機能フレームワーク
2. **フローティングメニュー**: 直感的なポップアップUI
3. **チェックボックス一括操作**: 全選択/全解除機能
4. **高品質フルページスクリーンショット**: Chrome DevTools Protocol 使用
   - 小さなページ: 一発キャプチャ（≤16384px）
   - 大きなページ: タイル分割キャプチャ（>16384px）

### 🔧 技術的特徴
- **Chrome DevTools と同等品質**: `Page.captureScreenshot` API 直接使用
- **固定ヘッダー問題解決**: 自動的に適切に処理
- **横スクロール完全対応**: ページの実際の幅を100%キャプチャ
- **高解像度対応**: devicePixelRatio 考慮

## インストールと使用方法

### インストール手順
1. Chrome の拡張機能ページ（`chrome://extensions/`）を開く
2. 「デベロッパーモード」を有効にする
3. 「パッケージ化されていない拡張機能を読み込む」をクリック
4. このプロジェクトフォルダを選択
5. アイコンファイル（16px、48px、128px）を作成して `icons/` フォルダに配置

### 使用方法
1. 対象Webページを開く
2. ブラウザツールバーの拡張機能アイコンをクリック
3. フローティングメニューから機能を選択：
   - 📸 **フルページスクリーンショット**: ページ全体を高品質でキャプチャ
   - ☑️ **すべてチェック**: ページ内のチェックボックスを一括選択
   - ☐ **すべてチェック解除**: ページ内のチェックボックスを一括解除

## 拡張可能性

将来的に追加可能な機能：
- **PDF エクスポート**: スクリーンショットを PDF 形式で保存
- **フォーム自動入力**: よく使用する値の自動入力
- **ページ内テキスト検索・ハイライト**: 高度な検索機能
- **カスタムCSS注入**: ページの見た目をカスタマイズ
- **ページ情報の抽出・エクスポート**: メタデータやコンテンツの構造化抽出
- **スクリーンショット範囲指定**: 特定領域のみをキャプチャ

---

## 開発者向け情報

この拡張機能は Chrome DevTools Protocol を活用した高品質なスクリーンショット機能を核とした、実用的なWeb作業効率化ツールです。Chrome Manifest V3 に完全対応し、最新のブラウザAPIを使用しています。
